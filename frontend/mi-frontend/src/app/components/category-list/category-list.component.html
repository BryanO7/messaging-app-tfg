<!-- src/app/components/category-list/category-list.component.html -->
<div class="category-list-container">
  <div class="header">
    <h2>GestiÃ³n de CategorÃ­as</h2>
    <button class="btn btn-primary" routerLink="/categories/new">
      + Nueva CategorÃ­a
    </button>
  </div>

  <!-- Controles de vista -->
  <div class="view-controls">
    <div class="view-mode-buttons">
      <button
        class="btn btn-mode"
        [class.active]="viewMode === 'hierarchy'"
        (click)="changeViewMode('hierarchy')">
        ğŸŒ³ Vista JerÃ¡rquica
      </button>
      <button
        class="btn btn-mode"
        [class.active]="viewMode === 'all'"
        (click)="changeViewMode('all')">
        ğŸ“‹ Todas las CategorÃ­as
      </button>
    </div>
  </div>

  <!-- Barra de bÃºsqueda -->
  <div class="search-bar">
    <div class="search-input-group">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (keyup.enter)="searchCategories()"
        placeholder="Buscar categorÃ­as..."
        class="form-control">
      <button class="btn btn-outline-secondary" (click)="searchCategories()">
        ğŸ”
      </button>
      <button class="btn btn-outline-secondary" (click)="clearSearch()" *ngIf="searchQuery">
        âœ• Limpiar
      </button>
    </div>
  </div>

  <!-- Mensaje de error -->
  <div class="alert alert-danger" *ngIf="error">
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadCategories()">
      Reintentar
    </button>
  </div>

  <!-- Loading spinner -->
  <div class="text-center" *ngIf="loading">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Vista JerÃ¡rquica (Solo categorÃ­as raÃ­z) -->
  <div class="categories-list" *ngIf="!loading && viewMode === 'hierarchy'">
    <div
      class="category-item clickable"
      *ngFor="let category of rootCategories; trackBy: trackByCategoryId"
      (click)="editCategory(category.id!)"
      title="Haz clic para editar">

      <div class="category-main">
        <div class="category-icon">ğŸ“</div>
        <div class="category-info">
          <h3 class="category-name">{{ category.name }}</h3>
          <p class="category-description" *ngIf="category.description">
            {{ category.description }}
          </p>
          <div class="category-meta">
            <span class="category-id">ğŸ“‹ ID: {{ category.id }}</span>
            <span class="category-created" *ngIf="category.createdAt">
              ğŸ“… Creada: {{ category.createdAt | date:'shortDate' }}
            </span>
          </div>
        </div>
      </div>

      <div class="category-actions" (click)="$event.stopPropagation()">
        <button
          class="btn btn-sm btn-outline-info"
          title="Crear subcategorÃ­a">
          ğŸ“‚ SubcategorÃ­as
        </button>
        <button
          class="btn btn-sm btn-outline-danger"
          (click)="deleteCategory(category.id!)"
          title="Eliminar categorÃ­a">
          ğŸ—‘ï¸ Eliminar
        </button>
      </div>
    </div>
  </div>

  <!-- Vista Todas las CategorÃ­as -->
  <div class="categories-list" *ngIf="!loading && viewMode === 'all'">
    <div
      class="category-item clickable"
      *ngFor="let category of categories; trackBy: trackByCategoryId"
      (click)="editCategory(category.id!)"
      title="Haz clic para editar">

      <div class="category-main">
        <div class="category-icon">{{ isRootCategory(category) ? 'ğŸ“' : 'ğŸ“‚' }}</div>
        <div class="category-info">
          <h3 class="category-name">
            {{ getFullCategoryName(category) }}
          </h3>
          <p class="category-description" *ngIf="category.description">
            {{ category.description }}
          </p>
          <div class="category-meta">
            <span class="category-id">ğŸ“‹ ID: {{ category.id }}</span>
            <span class="category-type">
              {{ isRootCategory(category) ? 'ğŸŒ³ CategorÃ­a RaÃ­z' : 'ğŸ“‚ SubcategorÃ­a' }}
            </span>
            <span class="category-created" *ngIf="category.createdAt">
              ğŸ“… {{ category.createdAt | date:'shortDate' }}
            </span>
          </div>
        </div>
      </div>

      <div class="category-actions" (click)="$event.stopPropagation()">
        <button
          class="btn btn-sm btn-outline-danger"
          (click)="deleteCategory(category.id!)"
          title="Eliminar categorÃ­a">
          ğŸ—‘ï¸ Eliminar
        </button>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay categorÃ­as -->
  <div class="empty-state" *ngIf="!loading && getDisplayCategories().length === 0">
    <div class="empty-content">
      <div class="empty-icon">ğŸ“</div>
      <h3 *ngIf="!searchQuery">No hay categorÃ­as</h3>
      <h3 *ngIf="searchQuery">No se encontraron categorÃ­as</h3>
      <p *ngIf="!searchQuery">
        Crea tu primera categorÃ­a para organizar tus contactos
      </p>
      <p *ngIf="searchQuery">
        No se encontraron categorÃ­as con: "<strong>{{ searchQuery }}</strong>"
      </p>
      <button
        class="btn btn-primary"
        routerLink="/categories/new"
        *ngIf="!searchQuery">
        + Crear primera categorÃ­a
      </button>
      <button
        class="btn btn-outline-primary"
        (click)="clearSearch()"
        *ngIf="searchQuery">
        Ver todas las categorÃ­as
      </button>
    </div>
  </div>

  <!-- InformaciÃ³n de ayuda -->
  <div class="help-section" *ngIf="!loading && getDisplayCategories().length > 0">
    <div class="help-content">
      <h4>ğŸ’¡ CÃ³mo usar:</h4>
      <ul>
        <li><strong>Haz clic en una categorÃ­a</strong> para editarla y gestionar sus contactos</li>
        <li><strong>Vista JerÃ¡rquica:</strong> Muestra solo categorÃ­as principales</li>
        <li><strong>Todas las CategorÃ­as:</strong> Muestra categorÃ­as y subcategorÃ­as</li>
        <li><strong>Buscar:</strong> Encuentra categorÃ­as por nombre</li>
      </ul>
    </div>
  </div>
</div>
